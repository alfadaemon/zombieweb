!function(a){var b=[],c=[],d=[],e=!1,f=100,g=null,h={Module:function(a,b){this.name=a,this.func=b},isModule:function(a){return a instanceof h.Module},"throw":function(a){throw Error("Molecule Error: "+a)},getSinon:function(){return a.sinon},getModule:function(a,b){for(var c,d=0;d<b.length;d++)if(b[d].name===a){c=b[d];break}return c||h.throw('Could not require module: "'+a+'". The name does not exist or loading it causes a loop.'),c},addModule:function(a,b,c){a.push(new h.Module(b,c))},registerModules:function(a,b){for(var c,d,e=!0,f=(new Date).getTime(),g=[];a.length&&!h.timeout(f);){e=!0,c=h.getLast(a),d=h.createContext(b);try{d.exports=c.func.apply(d,h.contextToArray(d))}catch(i){if(!i.message.match(/Molecule Error/))throw i;h.addDepException(g,i.message),h.moveLastToFirst(a),e=!1}e&&"undefined"==typeof d.exports&&h.throw("Module "+c.name+" is returning undefined, it has to return something"),e&&(c.exports=d.exports,h.moveLastToTarget(a,b))}h.timeout(f)&&h.throw("Timeout, could not load modules. The following dependencies gave errors: "+(g.length?g.join(", "):"")+". They do not exist or has caused a loop.")},contextToArray:function(a){return g?[g,a.require,a.privates]:[a.require,a.privates]},registerTestModule:function(a,b){for(var c,d,e,f=(new Date).getTime(),g=[];!e&&!h.timeout(f);)if(c=h.getLast(b),d=h.createTestContext(b),c.name===a){try{d.exports=c.func.apply(d,h.contextToArray(d))}catch(i){if(!i.message.match(/Molecule Error/))throw i;h.addDepException(g,i.message),h.moveLastToFirst(b)}e=c}else h.moveLastToFirst(b);return h.timeout(f)&&h.throw("Timeout, could not load modules. The following dependencies gave errors: "+(g.length?g.join(", "):a)+". They do not exist or has caused a loop."),d.exports||g.length?g.length&&h.throw("The following dependencies gave errors: "+g.join(", ")+". They do not exist or has caused a loop."):h.throw("Module "+e.name+" is returning undefined, it has to return something"),d},timeout:function(a){return(new Date).getTime()-a>=f},addDepException:function(a,b){b=b.match(/\"(.*)\"/)[1],-1===a.indexOf(b)&&a.push(b)},createGame:function(a,b,c){var e=h.getModule("Molecule.Game",d).exports;g=new e(a,b,c)},createContext:function(a){var b={privates:{},require:function(b){var c=h.getModule(b,a);return h.isModule(c)?c.exports:c},game:g};return b},createTestContext:function(a){var b={privates:{},deps:{}};return b.require=h.createTestRequireMethod(b,a),b},createTestRequireMethod:function(a,b){return function(c){var d=[],e=h.getModule(c,b),f={privates:{},require:function(c){var e=h.getModule(c,b);try{e=e.func.apply(a,h.contextToArray(a))}catch(f){if(!f.message.match(/Molecule Error/))throw f;h.addDepException(d,f.message)}return h.isModule(e)?e.exports:e}};return f.exports=h.isModule(e)?e.func.apply(f,h.contextToArray(f)):e,e.exports=h.stubDepExports(f.exports),a.deps[c]=e.exports,e.exports}},stubDepExports:function(a){var b=h.getSinon();if(b){var c={};if("function"==typeof a)return b.spy();for(var d in a)"function"==typeof a[d]&&(c[d]=a[d],b.stub(c,d));return c}return a},getLast:function(a){return a[a.length-1]},moveLastToFirst:function(a){a.unshift(a.pop())},moveLastToTarget:function(a,b){b.push(a.pop())},extractBrowserArgs:function(a){return{name:a[0],func:a[1]}}},i=function(a,e,f,g){var i,j=Array.prototype.slice.call(arguments,0);j.forEach(function(b){"function"==typeof b?g=b:"number"==typeof b&&void 0===a?a=b:"number"==typeof b&&void 0===e?e=b:"number"==typeof b&&void 0===f&&(f=b)}),h.registerModules(c,d),h.createGame(a,e,f),h.registerModules(b,d),i=h.createContext(d),g.call(i,i.game,i.require)};i.module=function(){var a=h.extractBrowserArgs(arguments);a.name&&"string"==typeof a.name&&a.func&&"function"==typeof a.func||h.throw("Invalid arguments for module creation, you have to pass a string and a function"),a.name.match(/Molecule/)?h.addModule(c,a.name,a.func):h.addModule(b,a.name,a.func)},i.test=function(a,c){e=!0;var d=h.registerTestModule(a,b);c.apply(d,[d.exports,d.privates,d.deps])},a.Molecule=i}(window),Molecule.module("Molecule.Animation",function(){function a(){this.frame=new Array,this.id=new Array,this.current={animation:0,frame:0},this.timer=0,this.loop=!0,this.reverse=!1,this.halt=!1}return a.prototype.sliceFrames=function(a,b,c,d){for(var e=0;b-1>e;e+=d)for(var f=0;a-1>f;f+=c)this.frame.push({x:f,y:e});a===c&&b===d&&this.add("",[0],60)},a.prototype.add=function(a,b,c){var d=60*c/b.length;this.id.push({name:a,frame:b,speed:d})},a.prototype.run=function(a,b,c){if(b=void 0===b?!0:b,c=void 0===c?!1:c,this.loop=b,this.reverse=c,this.halt=!1,-1===this.current.animation||this.id[this.current.animation].name!==a){this.current.frame=-1;for(var d=0;d<this.id.length;d++)this.id[d].name===a&&(this.current.animation=d,this.current.frame=0,this.timer=0)}},a.prototype.stop=function(){this.halt=!0},a.prototype.nextFrame=function(){this.halt||(this.timer++,this.timer>this.id[this.current.animation].speed&&(this.timer=0,this.reverse?(this.current.frame--,this.current.frame<0&&(this.current.frame=this.loop?this.id[this.current.animation].frame.length-1:0)):(this.current.frame++,this.current.frame>=this.id[this.current.animation].frame.length&&(this.current.frame=this.loop?0:this.id[this.current.animation].frame.length-1))))},a}),Molecule.module("Molecule.AudioFile",function(a){function b(a){this.game=a,this.name=new Array,this.data=new Array,this.counter=0}var c=a("Molecule.Sound");return b.prototype.load=function(a){if(!this.getAudioDataByName(a)){for(var b,d=this,e=new Audio,f=0;f<a.length;f++){var g=a[f].split(".");""!=e.canPlayType("audio/"+g[g.length-1])&&(b=a[f])}e.addEventListener("canplay",function(){d.counter++}),e.src=b,this.name.push(a),this.data.push(e)}var h=new c;return h.sound=this.getAudioDataByName(a),this.game.sound.push(h),h},b.prototype.isLoaded=function(){return this.counter===this.data.length?!0:!1},b.prototype.getAudioDataByName=function(a){return this.data[this.name.indexOf(a)]},b}),Molecule.module("Molecule.Camera",function(){function a(a){this.game=a,this.layer=null,this.sprite=null,this.scroll={x:!1,y:!1},this.type=0,this.offset={x:0,y:0}}return a.prototype.attach=function(a){this.sprite=a,this.type=1,this.set()},a.prototype.detach=function(){this.sprite=null,this.type=0},a.prototype.set=function(){if(1===this.type){this.layer=this.game.map.getMainLayer(),this.game.map.resetPosition(),_x=this.sprite.position.x,this.sprite.position.x=0,_y=this.sprite.position.y,this.sprite.position.y=0;for(var a=0;_x>a;a++)this.sprite.move.x=1,this.update(this.game.scene.sprites),this.game.cameraUpdate(),this.game.resetMove();for(var a=0;_y>a;a++)this.sprite.move.y=1,this.update(this.game.scene.sprites),this.game.cameraUpdate(),this.game.resetMove()}},a.prototype.update=function(a){null!==this.game.map&&-1!==this.layer&&(this.makeScroll(),this.makeMapScroll()),this.makeSpriteScroll(a,this.sprite.move.x,this.sprite.move.y)},a.prototype.makeScroll=function(){this.scroll.x=!1,this.scroll.y=!1;var a=this.game.map.canvas[this.layer].width,b=this.game.map.canvas[this.layer].height;this.game.map.json.layers[this.layer].properties.scroll.infinite.x&&(a=-this.game.map.json.layers[this.layer].x+this.game.canvas.width+1),this.game.map.json.layers[this.layer].properties.scroll.infinite.y&&(b=-this.game.map.json.layers[this.layer].y+this.game.canvas.height+1),this.game.map.json.layers[this.layer].properties.scrollable&&((-this.game.map.json.layers[this.layer].x+this.game.canvas.width<a&&this.sprite.move.x>0&&this.sprite.position.x-this.sprite.anchor.x+this.offset.x+this.sprite.frame.width/2>=this.game.canvas.width/2||-this.game.map.json.layers[this.layer].x>0&&this.sprite.move.x<0&&this.sprite.position.x-this.sprite.anchor.x+this.offset.x+this.sprite.frame.width/2<=this.game.canvas.width/2)&&(this.scroll.x=!0),(-this.game.map.json.layers[this.layer].y+this.game.canvas.height<b&&this.sprite.move.y>0&&this.sprite.position.y-this.sprite.anchor.y+this.offset.y+this.sprite.frame.height/2>=this.game.canvas.height/2||-this.game.map.json.layers[this.layer].y>0&&this.sprite.move.y<0&&this.sprite.position.y-this.sprite.anchor.y+this.offset.y+this.sprite.frame.height/2<=this.game.canvas.height/2)&&(this.scroll.y=!0))},a.prototype.makeMapScroll=function(){for(var a=0;a<this.game.map.json.layers.length;a++)if("tilelayer"===this.game.map.json.layers[a].type&&this.game.map.json.layers[a].properties.scrollable){var b=this.game.map.canvas[a].width,c=this.game.map.canvas[a].height;this.game.map.json.layers[a].properties.scroll.infinite.x&&(b=-this.game.map.json.layers[a].x+this.game.canvas.width+1),this.game.map.json.layers[a].properties.scroll.infinite.y&&(c=-this.game.map.json.layers[a].y+this.game.canvas.height+1),(-this.game.map.json.layers[a].x+this.game.canvas.width<b&&this.sprite.move.x>0&&this.sprite.position.x-this.sprite.anchor.x+this.offset.x+this.sprite.frame.width/2>=this.game.canvas.width/2||-this.game.map.json.layers[a].x>0&&this.sprite.move.x<0&&this.sprite.position.x-this.sprite.anchor.x+this.offset.x+this.sprite.frame.width/2<=this.game.canvas.width/2)&&this.scroll.x&&(this.game.map.json.layers[a].properties.scroll.x=a!==this.layer?this.sprite.move.x*-this.game.map.json.layers[a].properties.scroll.speed:-this.sprite.move.x),(-this.game.map.json.layers[a].y+this.game.canvas.height<c&&this.sprite.move.y>0&&this.sprite.position.y-this.sprite.anchor.y+this.offset.y+this.sprite.frame.height/2>=this.game.canvas.height/2||-this.game.map.json.layers[a].y>0&&this.sprite.move.y<0&&this.sprite.position.y-this.sprite.anchor.y+this.offset.y+this.sprite.frame.height/2<=this.game.canvas.height/2)&&this.scroll.y&&(this.game.map.json.layers[a].properties.scroll.y=a!==this.layer?this.sprite.move.y*-this.game.map.json.layers[a].properties.scroll.speed:-this.sprite.move.y)}},a.prototype.makeSpriteScroll=function(a,b,c){for(var d=0;d<a.length;d++)a[d].scrollable&&(this.scroll.x&&(a[d].move.x=a[d].move.x-b),this.scroll.y&&(a[d].move.y=a[d].move.y-c))},a}),Molecule.module("Molecule.Game",function(a,b){var c=a("Molecule.MapFile"),d=a("Molecule.Camera"),e=a("Molecule.Scene"),f=a("Molecule.Map"),g=a("Molecule.ImageFile"),h=a("Molecule.AudioFile"),i=a("Molecule.Input"),j=a("Molecule.Text"),k=a("Molecule.Physics"),l=a("Molecule.Move"),m=a("Molecule.SpriteCollisions"),n=a("Molecule.MapCollisions");b.init=null,b.run=null,b.update=function(a,b){for(var c,d=0;d<b.scene.sprites.length;d++)c=b.scene.sprites[d],c.update(),c.flipUpdate(),null!==c.animation&&a&&c.animation.nextFrame();null!==b.map&&b.map.update()},b.loadResources=function(a,c){if(c.sprite.isLoaded()&&c.tilemap.isLoaded()&&c.audio.isLoaded()){clearInterval(a);for(var d=0;d<c.scene.sprites.length;d++)c.scene.sprites[d].getAnimation();b.init(),b.loop(c)}},b.removeSprites=function(a){for(var b=a.length-1;b>=0;b--)a[b].kill&&a.splice(b,1)},b.resetCollisionState=function(a){for(var b,c=0;c<a.length;c++)b=a[c],b.collision.sprite.id=null,b.collision.sprite.left=!1,b.collision.sprite.right=!1,b.collision.sprite.up=!1,b.collision.sprite.down=!1,b.collision.map.tile=null,b.collision.map.left=!1,b.collision.map.right=!1,b.collision.map.up=!1,b.collision.map.down=!1},b.loop=function(a){if(b.requestAnimFrame(function(){b.loop(a)}),b.removeSprites(a.scene.sprites),b.update(null,a),1==a.status){var c=!1;for(k(a),b.resetCollisionState(a.scene.sprites);!c;)c=l(a.scene.sprites),n(a),m(a),b.updateSpriteCollisionCheck(a.scene.sprites),1===a.camera.type&&a.camera.update(a.scene.sprites),b.update(c,a),b.checkBoundaries(a),a.resetMove()}b.draw(a),b.run()},b.updateSpriteCollisionCheck=function(a){for(var b,c=0;c<a.length;c++)b=a[c],b.speed.check.x&&b.speed.check.y&&b.resetMove()},b.checkBoundaries=function(a){for(var b,c=0;c<a.scene.sprites.length;c++)b=a.scene.sprites[c],null!==a.boundaries.x&&(b.position.x-b.anchor.x<a.boundaries.x&&(b.position.x=a.boundaries.x+b.anchor.x),b.position.x+b.frame.width-b.anchor.x>a.boundaries.x+a.boundaries.width&&(b.position.x=a.boundaries.x+a.boundaries.width-b.frame.width+b.anchor.x)),null!==a.boundaries.y&&(b.position.y-b.anchor.y<a.boundaries.y&&(b.position.y=a.boundaries.y+b.anchor.y),b.position.y+b.frame.height-b.anchor.y>a.boundaries.y+a.boundaries.height&&(b.position.y=a.boundaries.y+a.boundaries.height-b.frame.height+b.anchor.y))},b.draw=function(a){a.context.clearRect(0,0,a.canvas.width,a.canvas.height),null!==a.map&&a.map.visible&&a.map.draw(!1);for(var b=0;b<a.scene.sprites.length;b++)a.scene.sprites[b].visible&&a.scene.sprites[b].draw(!1);for(var b=0;b<a.scene.sprites.length;b++)a.scene.sprites[b].visible&&a.scene.sprites[b].draw(!0);null!==a.map&&a.map.visible&&a.map.draw(!0);for(var b=0;b<a.scene.text.length;b++)a.scene.text[b].visible&&a.scene.text[b].draw()},b.requestAnimFrame=function(){var a=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){window.setTimeout(a,1e3/60)};return a.bind(window)}(),b.start=function(a){var c=setInterval(function(){b.loadResources(c,a)},100)};var o=function(a,b,j){this.canvas=null,this.context=null,this.scale=j||1,this.physics={gravity:{x:0,y:0},friction:{x:0,y:0}},this.boundaries={x:null,y:null,width:null,height:null},this.tilemap=new c(this),this.camera=new d(this),this.scene=new e(this),this.map=new f(this),this.next={scene:null,fade:null},this.sprite=new g(this),this.audio=new h(this),this.sound=new Array,this.input=new i(this),this.status=1,this.timer={loop:.06,previus:null,now:null,fps:60,frame:0},this.width=a,this.height=b,this.canvas=document.createElement("canvas"),this.canvas.setAttribute("id","canvas"),this.canvas.width=a,this.canvas.height=b,this.canvas.style.width=a*this.scale+"px",this.canvas.style.height=b*this.scale+"px",this.context=this.canvas.getContext("2d"),document.body.appendChild(this.canvas)};return o.prototype.init=function(a){b.start(this),a()},o.prototype.init=function(a){b.init=a,b.start(this),delete this.init},o.prototype.update=function(a){b.run=a},o.prototype.text=function(a,b,c,d){var e=new j(a,b,c,d,this);return this.scene.text.push(e),e},o.prototype.updateTimer=function(){this.timer.frame++,this.timer.now=(new Date).getTime(),null!==this.timer.previus&&(this.timer.loop=(this.timer.now-this.timer.previus)/1e3),this.timer.now-this.timer.previus>=1e3&&(this.timer.previus=this.timer.now,this.timer.fps=this.timer.frame,this.timer.frame=0)},o.prototype.play=function(){this.status=1},o.prototype.stop=function(){this.status=0},o.prototype.resetMove=function(){for(var a=0;a<this.scene.sprites.length;a++)this.scene.sprites[a].resetMove();null!==this.map&&this.map.resetScroll(),b.update(null,this)},o.prototype.cameraUpdate=function(a){for(var b=0;b<this.scene.sprites.length;b++)this.scene.sprites[b].update(),this.scene.sprites[b].flipUpdate(),null!==this.scene.sprites[b].animation&&a&&this.scene.sprites[b].animation.nextFrame();null!==this.map&&this.map.update()},o.prototype.run=function(){console.log("running"),b.run()},o}),Molecule.module("Molecule.ImageFile",function(a){function b(a){this.game=a,this.name=new Array,this.data=new Array,this.counter=0}var c=a("Molecule.Sprite");return b.prototype.preload=function(a){var b=a.substring(0,a.length-4);if(!this.getImageDataByName(b)){var c=this,d=new Image;d.addEventListener("load",function(){c.counter++}),d.src=a,this.name.push(b),this.data.push(d)}return this.getImageDataByName(b)},b.prototype.load=function(a,b,d){var e=new c(a,b,d);return e.game=this.game,e.image=this.preload(a),this.isLoaded()&&e.getAnimation(),this.game.scene.sprites.push(e),e},b.prototype.reset=function(){this.game.scene.sprites=[]},b.prototype.isLoaded=function(){return this.counter===this.data.length?!0:!1},b.prototype.getImageDataByName=function(a){return this.data[this.name.indexOf(a)]},b}),Molecule.module("Molecule.Input",function(){function a(a){this.game=a,this.key={SPACE:0,LEFT_ARROW:0,UP_ARROW:0,RIGHT_ARROW:0,DOWN_ARROW:0,A:0,B:0,C:0,D:0,E:0,F:0,G:0,H:0,I:0,J:0,K:0,L:0,M:0,N:0,O:0,P:0,Q:0,R:0,S:0,T:0,U:0,V:0,W:0,X:0,Y:0,Z:0},this.mouse={x:0,y:0,BUTTON_LEFT:0,BUTTON_MIDDLE:0,BUTTON_RIGHT:0},this.touch=new Array}return a.prototype.enable=function(a){var b=this;"keyboard"===a&&(document.addEventListener("keydown",function(a){b.onkeydown(a)},!0),document.addEventListener("keyup",function(a){b.onkeyup(a)},!0)),"mouse"===a&&(this.game.canvas.addEventListener("mousedown",function(a){b.onmousedown(a)},!0),this.game.canvas.addEventListener("mousemove",function(a){b.onmousemove(a)},!0),this.game.canvas.addEventListener("mouseup",function(a){b.onmouseup(a)},!0)),"touch"===a&&(this.game.canvas.addEventListener("MSPointerDown",function(a){b.ontouchstart(a)},!0),this.game.canvas.addEventListener("MSPointerMove",function(a){b.ontouchmove(a)},!0),this.game.canvas.addEventListener("MSPointerUp",function(a){b.ontouchend(a)},!0),this.game.canvas.addEventListener("MSPointerCancel",function(a){b.ontouchcancel(a)},!0),this.game.canvas.addEventListener("touchstart",function(a){b.ontouchstart(a)},!0),this.game.canvas.addEventListener("touchmove",function(a){b.ontouchmove(a)},!0),this.game.canvas.addEventListener("touchend",function(a){b.ontouchend(a)},!0),this.game.canvas.addEventListener("touchcancel",function(a){b.ontouchcancel(a)},!0))},a.prototype.disable=function(a){var b=this;"keyboard"===a&&(document.removeEventListener("keydown",function(a){b.onkeydown(a)},!0),document.removeEventListener("keyup",function(a){b.onkeyup(a)},!0)),"mouse"===a&&(this.game.canvas.removeEventListener("mousedown",function(a){b.onmousedown(a)},!0),this.game.canvas.removeEventListener("mousemove",function(a){b.onmousemove(a)},!0),this.game.canvas.removeEventListener("mouseup",function(a){b.onmouseup(a)},!0)),"touch"===a&&(this.game.canvas.removeEventListener("MSPointerDown",function(a){b.ontouchstart(a)},!0),this.game.canvas.removeEventListener("MSPointerMove",function(a){b.ontouchmove(a)},!0),this.game.canvas.removeEventListener("MSPointerUp",function(a){b.ontouchend(a)},!0),this.game.canvas.removeEventListener("MSPointerCancel",function(a){b.ontouchcancel(a)},!0),this.game.canvas.removeEventListener("touchstart",function(a){b.ontouchstart(a)},!0),this.game.canvas.removeEventListener("touchmove",function(a){b.ontouchmove(a)},!0),this.game.canvas.removeEventListener("touchend",function(a){b.ontouchend(a)},!0),this.game.canvas.removeEventListener("touchcancel",function(a){b.ontouchcancel(a)},!0))},a.prototype.onkeydown=function(a){switch(a.preventDefault(),a.keyCode){case 32:this.key.SPACE=1;break;case 37:this.key.LEFT_ARROW=1;break;case 38:this.key.UP_ARROW=1;break;case 39:this.key.RIGHT_ARROW=1;break;case 40:this.key.DOWN_ARROW=1;break;case 65:this.key.A=1;break;case 66:this.key.B=1;break;case 67:this.key.C=1;break;case 68:this.key.D=1;break;case 69:this.key.E=1;break;case 70:this.key.F=1;break;case 71:this.key.G=1;break;case 72:this.key.H=1;break;case 73:this.key.I=1;break;case 74:this.key.J=1;break;case 75:this.key.K=1;break;case 76:this.key.L=1;break;case 77:this.key.M=1;break;case 78:this.key.N=1;break;case 79:this.key.O=1;break;case 80:this.key.P=1;break;case 81:this.key.Q=1;break;case 82:this.key.R=1;break;case 83:this.key.S=1;break;case 84:this.key.T=1;break;case 85:this.key.U=1;break;case 86:this.key.V=1;break;case 87:this.key.W=1;break;case 88:this.key.X=1;break;case 89:this.key.Y=1;break;case 90:this.key.Z=1}},a.prototype.onkeyup=function(a){switch(a.preventDefault(),a.keyCode){case 32:this.key.SPACE=0;break;case 37:this.key.LEFT_ARROW=0;break;case 38:this.key.UP_ARROW=0;break;case 39:this.key.RIGHT_ARROW=0;break;case 40:this.key.DOWN_ARROW=0;break;case 65:this.key.A=0;break;case 66:this.key.B=0;break;case 67:this.key.C=0;break;case 68:this.key.D=0;break;case 69:this.key.E=0;break;case 70:this.key.F=0;break;case 71:this.key.G=0;break;case 72:this.key.H=0;break;case 73:this.key.I=0;break;case 74:this.key.J=0;break;case 75:this.key.K=0;break;case 76:this.key.L=0;break;case 77:this.key.M=0;break;case 78:this.key.N=0;break;case 79:this.key.O=0;break;case 80:this.key.P=0;break;case 81:this.key.Q=0;break;case 82:this.key.R=0;break;case 83:this.key.S=0;break;case 84:this.key.T=0;break;case 85:this.key.U=0;break;case 86:this.key.V=0;break;case 87:this.key.W=0;break;case 88:this.key.X=0;break;case 89:this.key.Y=0;break;case 90:this.key.Z=0}},a.prototype.onmousedown=function(a){switch(a.button){case 0:this.mouse.BUTTON_LEFT=1;break;case 1:this.mouse.BUTTON_MIDDLE=1;break;case 2:this.mouse.BUTTON_RIGHT=1}this.mousePosition(a)},a.prototype.onmousemove=function(a){this.mousePosition(a)},a.prototype.onmouseup=function(a){switch(a.button){case 0:this.mouse.BUTTON_LEFT=0;break;case 1:this.mouse.BUTTON_MIDDLE=0;break;case 2:this.mouse.BUTTON_RIGHT=0}this.mousePosition(a)},a.prototype.mousePosition=function(a){this.mouse.x=(a.pageX-this.game.canvas.offsetLeft)/this.game.scale,this.mouse.y=(a.pageY-this.game.canvas.offsetTop)/this.game.scale},a.prototype.ontouchstart=function(a){a.preventDefault(),this.normalizeTouches(a)},a.prototype.ontouchmove=function(a){a.preventDefault(),this.normalizeTouches(a)},a.prototype.ontouchend=function(a){a.preventDefault(),this.normalizeTouches(a)},a.prototype.ontouchcancel=function(a){a.preventDefault(),this.touch=[]},a.prototype.normalizeTouches=function(a){if(this.touch=[],a.touches)for(var b=0;b<a.touches.length;b++)this.touch.push({x:(a.touches[b].pageX-this.game.canvas.offsetLeft)/this.game.scale,y:(a.touches[b].pageY-this.game.canvas.offsetTop)/this.game.scale});else void 0!==a&&this.touch.push({x:(a.pageX-this.game.canvas.offsetLeft)/this.game.scale,y:(a.pageY-this.game.canvas.offsetTop)/this.game.scale})},a}),Molecule.module("Molecule.Map",function(){function a(a){this.game=a,this.canvas=[],this.context=[],this.name=null,this.visible=!0,this.image=[],this.path="",this.response=null,this.json=null,this.loaded=!1}return a.prototype.load=function(a){this.name=a;for(var b=a.split("/"),c=0;c<b.length-1;c++)this.path+=b[c]+"/";this.ajaxJsonReq(this.name)},a.prototype.ajaxJsonReq=function(a){var b=this,c=new XMLHttpRequest;c.open("GET",a,!0),c.setRequestHeader("Content-type","application/json"),c.addEventListener("readystatechange",function(){b.jsonLoaded(c)}),c.send()},a.prototype.jsonLoaded=function(a){4==a.readyState&&200==a.status&&(this.response=a.responseText,this.json=JSON.parse(this.response),this.addProperties(),this.loadImages())},a.prototype.reset=function(){this.json=null,this.json=JSON.parse(this.response),this.addProperties(),this.canvas=[],this.context=[],this.createContext()},a.prototype.loadImages=function(){for(var a=this,b=0;b<this.json.tilesets.length;b++){var c=this.game.sprite.preload(this.path+this.json.tilesets[b].image);this.image.push(c)}var d=setInterval(function(){a.loadResources(d)},100)},a.prototype.loadResources=function(a){this.game.sprite.isLoaded()&&(clearInterval(a),this.createContext(),this.loaded=!0)},a.prototype.addProperties=function(){for(var a=0;a<this.json.layers.length;a++)if("tilelayer"===this.json.layers[a].type)if(void 0!==this.json.layers[a].properties){var b="true"===this.json.layers[a].properties.main?!0:!1,c="false"===this.json.layers[a].properties.scrollable?!1:!0,d="true"===this.json.layers[a].properties.collidable?!0:!1,e="true"===this.json.layers[a].properties.overlap?!0:!1,f=parseFloat(this.json.layers[a].properties["scroll.speed"]).toFixed(3)||1,g="true"===this.json.layers[a].properties["scroll.infinite.x"]?!0:!1,h="true"===this.json.layers[a].properties["scroll.infinite.y"]?!0:!1;this.json.layers[a].properties={scroll:{x:0,y:0,speed:f,infinite:{x:g,y:h}},main:b,scrollable:c,collidable:d,overlap:e,infinite:{x:g,y:h}}}else this.json.layers[a].properties={scroll:{x:0,y:0,speed:1,infinite:{x:!1,y:!1}},main:!1,scrollable:!0,collidable:!1,overlap:!1,infinite:{x:!1,y:!1}}},a.prototype.createContext=function(){for(var a=0;a<this.json.layers.length;a++)if("tilelayer"===this.json.layers[a].type)for(this.canvas.push(document.createElement("canvas")),this.context.push(this.canvas[a].getContext("2d")),this.canvas[a].width=this.json.layers[a].width*this.json.tilewidth,this.canvas[a].height=this.json.layers[a].height*this.json.tileheight,j=0;j<this.json.layers[a].data.length;j++){var b=this.json.layers[a].data[j];if(b>0){var c=this.getTileset(b);this.context[a].save(),this.context[a].globalAlpha=this.json.layers[a].opacity,this.context[a].drawImage(this.image[c],Math.floor((b-this.json.tilesets[c].firstgid)%(this.json.tilesets[c].imagewidth/this.json.tilesets[c].tilewidth))*this.json.tilesets[c].tilewidth,Math.floor((b-this.json.tilesets[c].firstgid)/(this.json.tilesets[c].imagewidth/this.json.tilesets[c].tilewidth))*this.json.tilesets[c].tilewidth,this.json.tilesets[c].tilewidth,this.json.tilesets[c].tileheight,Math.floor(j%this.json.layers[a].width)*this.json.tilewidth,Math.floor(j/this.json.layers[a].width)*this.json.tilewidth,this.json.tilewidth,this.json.tileheight),this.context[a].restore()}}},a.prototype.getTileset=function(a){for(var b=0;b<this.json.tilesets.length;b++){if(1===this.json.tilesets.length||this.json.tilesets.length===b||this.json.tilesets[b].firstgid===a)return b;if(this.json.tilesets[b].firstgid>a)return b-1}},a.prototype.getMainLayer=function(){if(null!==this.json)for(var a=0;a<this.json.layers.length;a++)if("tilelayer"===this.game.map.json.layers[a].type&&this.json.layers[a].properties.main)return a;return-1},a.prototype.getLayerIdByName=function(a){for(var b=0;b<this.json.layers.length;b++)if(this.json.layers[b].name===a)return b;return-1},a.prototype.getTilesetIdByName=function(a){for(var b=0;b<this.json.tilesets.length;b++)if(this.json.tilesets[b].name===a)return b;return-1},a.prototype.getTile=function(a,b,c,d,e){d=d||0,e=e||0;var f=this.getLayerIdByName(a);if("tilelayer"===this.json.layers[f].type){this.json.layers[f].properties.scroll.infinite.x&&b>=this.canvas[f].width/2&&(b=Math.floor(b%this.canvas[f].width)),this.json.layers[f].properties.scroll.infinite.y&&c>=this.canvas[f].height/2&&(c=Math.floor(c%this.canvas[f].height));var g=Math.floor(c/this.json.tileheight)*this.json.layers[f].width+Math.floor(b/this.json.tilewidth);return g>=this.json.layers[f].data.length||0>g||b>this.json.layers[f].width*this.json.tilewidth||0>b+d||c>this.json.layers[f].height*this.json.tileheight||0>c+e?null:g}return null},a.prototype.getTileData=function(a,b,c){var d=this.getLayerIdByName(a),e=this.getTile(a,b,c);return null===e?null:this.json.layers[d].data[e]},a.prototype.clearTile=function(a,b,c){var d=this.getLayerIdByName(a),e=this.json.layers[d],f=this.getTile(a,b,c);null!==f&&(e.data[f]=0,this.context[d].save(),this.context[d].globalAlpha=e.opacity,this.context[d].clearRect(Math.floor(f%this.json.layers[d].width)*this.json.tilewidth,Math.floor(f/this.json.layers[d].width)*this.json.tilewidth,this.json.tilewidth,this.json.tileheight),this.context[d].restore())},a.prototype.setTile=function(a,b,c,d,e){var f=this.getLayerIdByName(a),g=this.json.layers[f],h=this.getTile(a,b,c),i=this.getTilesetIdByName(d),j=e+this.json.tilesets[i].firstgid;null!==h&&(g.data[h]=j,this.context[f].save(),this.context[f].globalAlpha=this.json.layers[f].opacity,this.context[f].drawImage(this.image[i],Math.floor((j-this.json.tilesets[i].firstgid)%this.json.layers[f].width)*this.json.tilesets[i].tilewidth,Math.floor((j-this.json.tilesets[i].firstgid)/this.json.layers[f].width)*this.json.tilesets[i].tilewidth,this.json.tilesets[i].tilewidth,this.json.tilesets[i].tileheight,Math.floor(h%this.json.layers[f].width)*this.json.tilewidth,Math.floor(h/this.json.layers[f].width)*this.json.tilewidth,this.json.tilewidth,this.json.tileheight),this.context[f].restore())},a.prototype.update=function(){if(null!==this.json)for(var a=0;a<this.json.layers.length;a++)"tilelayer"===this.json.layers[a].type&&(this.json.layers[a].x+=this.json.layers[a].properties.scroll.x,this.json.layers[a].y+=this.json.layers[a].properties.scroll.y,this.json.layers[a].x=parseFloat(this.json.layers[a].x.toFixed(3)),this.json.layers[a].y=parseFloat(this.json.layers[a].y.toFixed(3)),this.json.layers[a].properties.scroll.infinite.x&&Math.round(this.json.layers[a].x)<=-this.canvas[a].width&&this.json.layers[a].properties.scroll.x<0?this.json.layers[a].x=0:this.json.layers[a].properties.scroll.infinite.x&&Math.round(this.json.layers[a].x)>=0&&this.json.layers[a].properties.scroll.x>0&&(this.json.layers[a].x=-this.canvas[a].width+1),this.json.layers[a].properties.scroll.infinite.y&&Math.round(this.json.layers[a].y)<=-this.canvas[a].height&&this.json.layers[a].properties.scroll.y<0?this.json.layers[a].y=0:this.json.layers[a].properties.scroll.infinite.y&&Math.round(this.json.layers[a].y)>=0&&this.json.layers[a].properties.scroll.y>0&&(this.json.layers[a].y=-this.canvas[a].height+1))},a.prototype.resetScroll=function(){if(null!==this.json)for(var a=0;a<this.json.layers.length;a++)"tilelayer"===this.json.layers[a].type&&(this.json.layers[a].properties.scroll.x=0,this.json.layers[a].properties.scroll.y=0)},a.prototype.resetPosition=function(){for(var a=0;a<this.json.layers.length;a++)"tilelayer"===this.json.layers[a].type&&(this.json.layers[a].x=0,this.json.layers[a].y=0)},a.prototype.draw=function(a){for(var b=0;b<this.canvas.length;b++)if("tilelayer"===this.json.layers[b].type&&this.json.layers[b].visible&&this.json.layers[b].properties.overlap===a){var c=this.game.canvas.width>this.canvas[b].width?this.canvas[b].width:this.game.canvas.width,d=this.game.canvas.height>this.canvas[b].height?this.canvas[b].height:this.game.canvas.height,e=0,f=0;this.json.layers[b].properties.scroll.infinite.x&&Math.floor(-this.json.layers[b].x)+c>this.canvas[b].width&&(e=Math.floor(-this.json.layers[b].x)+c-this.canvas[b].width),this.json.layers[b].properties.scroll.infinite.y&&Math.floor(-this.json.layers[b].y)+d>this.canvas[b].height&&(f=Math.floor(-this.json.layers[b].y)+d-this.canvas[b].height),this.game.context.save(),this.game.context.drawImage(this.canvas[b],Math.floor(-this.json.layers[b].x),Math.floor(-this.json.layers[b].y),c-e,d-f,0,0,c-e,d-f),this.game.context.restore(),this.json.layers[b].properties.scroll.infinite.x&&e>0&&(this.game.context.save(),this.game.context.drawImage(this.canvas[b],0,0,e,d,c-e,0,e,d),this.game.context.restore()),this.json.layers[b].properties.scroll.infinite.y&&f>0&&(this.game.context.save(),this.game.context.drawImage(this.canvas[b],0,0,c,f,0,d-f,c,f),this.game.context.restore()),this.json.layers[b].properties.scroll.infinite.x&&this.json.layers[b].properties.scroll.infinite.y&&e>0&&f>0&&(this.game.context.save(),this.game.context.drawImage(this.canvas[b],0,0,e,f,c-e,d-f,e,f),this.game.context.restore())}},a}),Molecule.module("Molecule.MapCollisions",function(a,b){return b.spriteCollidesWithLayer=function(a,b){return"tilelayer"===a.type&&a.properties.collidable&&b.collides.map},b.getHeight=function(a,b){return Math.ceil((b.frame.height-b.frame.offset.y-b.frame.offset.y)/a)},b.getWidth=function(a,b){return Math.ceil((b.frame.width-b.frame.offset.x-b.frame.offset.x)/a)},b.getPosX=function(a,b,c){return b.position.x-b.anchor.x+b.move.x+Math.abs(a.x)+c},b.getPosY=function(a,b,c){return b.position.y-b.anchor.y+b.move.y+Math.abs(a.y)+c},b.updateCollisionX=function(a,b,c,d,e){b.collidesWithTile(a,c,d)&&(b.move.y>0&&(b.collision.map.down=!0,b.collision.map.tile=c),b.move.y<0&&(b.collision.map.up=!0,b.collision.map.tile=c),b.collision.map.down&&e.gravity.y>0&&(b.speed.gravity.y=0),b.collision.map.up&&e.gravity.y<0&&(b.speed.gravity.y=0),(b.collision.check.map.up&&b.collision.map.up||b.collision.check.map.down&&b.collision.map.down)&&(b.move.y=0,b.speed.y=0,b.speed.t.y=0))},b.updateCollisionY=function(a,b,c,d,e){b.collidesWithTile(a,c,d)&&(b.move.x>0&&(b.collision.map.right=!0,b.collision.map.tile=c),b.move.x<0&&(b.collision.map.left=!0,b.collision.map.tile=c),b.collision.map.left&&e.gravity.x<0&&(b.speed.gravity.x=0),b.collision.map.right&&e.gravity.x>0&&(b.speed.gravity.x=0),!b.collision.check.map.up&&b.collision.map.up||!b.collision.check.map.down&&b.collision.map.down||(b.collision.check.map.left&&b.collision.map.left||b.collision.check.map.right&&b.collision.map.right)&&(b.move.x=0,b.speed.x=0,b.speed.t.x=0))
},function(a){var c,d,e,f,g,h,i,j,k,l,m=a.map,n=a.scene.sprites;if(m&&m.json)for(c=0;c<n.length;c++)for(g=n[c],d=0;d<m.json.layers.length;d++)if(h=m.json.layers[d],b.spriteCollidesWithLayer(h,g))for(i=0;2>=i;){if(0!==g.move.x||0!==g.move.y)for(e=0;e<=b.getHeight(m.json.tileheight,g);e++)for(f=0;f<=b.getWidth(m.json.tilewidth,g);f++)j=m.getTile(h.name,b.getPosX(h,g,f*m.json.tilewidth),b.getPosY(h,g,e*m.json.tileheight),g.frame.width,g.frame.height),null!==j&&h.data[j%h.data.length]>0&&g.collidesWithTile(h,j,d)&&((0===i||2===i)&&(k=g.move.x,g.move.x=0,b.updateCollisionX(h,g,j,d,a.physics),g.move.x=k),(1===i||2===i)&&(l=g.move.y,2!==i&&(g.move.y=0),b.updateCollisionY(h,g,j,d,a.physics),g.move.y=l));i++}}}),Molecule.module("Molecule.MapFile",function(a){function b(a){this.game=a,this.tile=new c(a),this.map=[]}var c=a("Molecule.Tile"),d=a("Molecule.Map");return b.prototype.load=function(a){var b=new d(this.game);return b.load(a),this.map.push(b),b},b.prototype.isLoaded=function(){for(var a=!0,b=0;b<this.map.length;b++)this.map[b].loaded||(a=!1);return a},b.prototype.set=function(a,b){b=b||!1,this.game.camera.detach(),b&&a.reset(),this.game.map=a},b.prototype.sprite=function(a){for(var b=0;b<this.game.map.json.layers.length;b++)if("objectgroup"===this.game.map.json.layers[b].type)for(var c=0;c<this.game.map.json.layers[b].objects.length;c++)if(this.game.map.json.layers[b].objects[c].name===a){var d=this.game.map.getTileset(this.game.map.json.layers[b].objects[c].gid),e=this.game.sprite.load(this.game.map.path+this.game.map.json.tilesets[this.game.map.getTilesetIdByName(a)].image,this.game.map.json.tilesets[d].tilewidth,this.game.map.json.tilesets[d].tileheight);return e.name=this.game.map.json.layers[b].objects[c].name,e.position.x=parseInt(this.game.map.json.layers[b].objects[c].x),e.position.y=parseInt(this.game.map.json.layers[b].objects[c].y)-e.frame.height,e.visible=this.game.map.json.layers[b].objects[c].visible,e.anchor.x=parseInt(this.game.map.json.layers[b].objects[c].properties["anchor.x"])||e.anchor.x,e.anchor.y=parseInt(this.game.map.json.layers[b].objects[c].properties["anchor.y"])||e.anchor.y,e.flip.x=parseInt(this.game.map.json.layers[b].objects[c].properties["flip.x"])||e.flip.x,e.flip.y=parseInt(this.game.map.json.layers[b].objects[c].properties["flip.y"])||e.flip.y,e.frame.width=parseInt(this.game.map.json.layers[b].objects[c].properties["frame.width"])||e.frame.width,e.frame.height=parseInt(this.game.map.json.layers[b].objects[c].properties["frame.height"])||e.frame.height,e.frame.offset.x=parseInt(this.game.map.json.layers[b].objects[c].properties["frame.offset.x"])||e.frame.offset.x,e.frame.offset.y=parseInt(this.game.map.json.layers[b].objects[c].properties["frame.offset.y"])||e.frame.offset.y,e.collides.sprite="false"===this.game.map.json.layers[b].objects[c].properties["collides.sprite"]?!1:!0,e.collides.map="false"===this.game.map.json.layers[b].objects[c].properties["collides.map"]?!1:!0,e.scrollable="false"===this.game.map.json.layers[b].objects[c].properties.scrollable?!1:!0,e.collidable="false"===this.game.map.json.layers[b].objects[c].properties.collidable?!1:!0,e.speed.min.x=parseFloat(this.game.map.json.layers[b].objects[c].properties["speed.min.x"]).toFixed(3)||e.speed.min.x,e.speed.min.y=parseFloat(this.game.map.json.layers[b].objects[c].properties["speed.min.y"]).toFixed(3)||e.speed.min.y,e.speed.max.x=parseFloat(this.game.map.json.layers[b].objects[c].properties["speed.max.x"]).toFixed(3)||e.speed.max.x,e.speed.max.y=parseFloat(this.game.map.json.layers[b].objects[c].properties["speed.max.y"]).toFixed(3)||e.speed.max.y,e.affects.physics.gravity="false"===this.game.map.json.layers[b].objects[c].properties["affects.physics.gravity"]?!1:!0,e.affects.physics.friction="false"===this.game.map.json.layers[b].objects[c].properties["affects.physics.friction"]?!1:!0,e.bounciness="true"===this.game.map.json.layers[b].objects[c].properties.bounciness?!0:!1,e.overlap="true"===this.game.map.json.layers[b].objects[c].properties.overlap?!0:!1,e}},b}),Molecule.module("Molecule.Move",function(){return function(a){for(var b,c,d=!0,e=0;e<a.length;e++)c=a[e],b=!0,c.speed.check.x=!0,c.speed.check.y=!0,c.speed.t.x>=1?(c.speed.t.x-=1,c.move.x=1,b=!1,d=!1,c.speed.check.x=!1):c.speed.t.x<=-1&&(c.speed.t.x+=1,c.move.x=-1,b=!1,d=!1,c.speed.check.x=!1),c.speed.t.y>=1?(c.speed.t.y-=1,c.move.y=1,b=!1,d=!1,c.speed.check.y=!1):c.speed.t.y<=-1&&(c.speed.t.y+=1,c.move.y=-1,b=!1,d=!1,c.speed.check.y=!1),b&&(0!==c.speed.t.x&&(c.move.x=c.speed.t.x>0?1:-1),0!==c.speed.t.y&&(c.move.y=c.speed.t.y>0?1:-1));return d}}),Molecule.module("Molecule.Physics",function(a,b){return b.addFriction=function(a,b){a.speed.x>0?(a.speed.x=a.speed.x*(1-b.physics.friction.x),a.speed.x<.05&&(a.speed.x=0)):a.speed.x<0&&(a.speed.x=a.speed.x*(1-b.physics.friction.x),a.speed.x>.05&&(a.speed.x=0)),a.speed.y>0?(a.speed.y=a.speed.y*(1-b.physics.friction.y),a.speed.y<.05&&(a.speed.y=0)):a.speed.y<0&&(a.speed.y=a.speed.y*(1-b.physics.friction.y),a.speed.y>.05&&(a.speed.y=0))},b.spriteHitsPlatformBelow=function(a,b){return a.affects.physics.gravity&&b.physics.gravity.y>0&&a.collision.sprite.down&&b.scene.sprites[a.collision.sprite.id].platform},b.spriteHitsPlatformAbove=function(a,b){return a.affects.physics.gravity&&b.physics.gravity.y<0&&a.collision.sprite.up&&b.scene.sprites[a.collision.sprite.id].platform},b.spriteHitsPlatformRight=function(a,b){return a.affects.physics.gravity&&b.physics.gravity.x>0&&a.collision.sprite.right&&b.scene.sprites[a.collision.sprite.id].platform},b.spriteHitsPlatformLeft=function(a,b){return a.affects.physics.gravity&&b.physics.gravity.x<0&&a.collision.sprite.left&&b.scene.sprites[a.collision.sprite.id].platform},b.spriteSlowerThanCollisionSprite=function(a,b,c){return b.speed[a]>=0&&b.speed[a]<c.scene.sprites[b.collision.sprite.id].speed[a]},b.spriteFasterThanCollisionSprite=function(a,b,c){return b.speed[a]<=0&&b.speed[a]>c.scene.sprites[b.collision.sprite.id].speed[a]},b.increaseAcceleration=function(a){a.speed.x+=a.acceleration.x,a.speed.y+=a.acceleration.y},b.setSpeed=function(a){var b=a.speed.x>=0?1:-1,c=a.speed.y>=0?1:-1;Math.abs(a.speed.x)>a.speed.max.x&&(a.speed.x=a.speed.max.x*b),Math.abs(a.speed.y)>a.speed.max.y&&(a.speed.y=a.speed.max.y*c)},b.addGravity=function(a,b){a.speed.x-=a.speed.gravity.x,a.speed.y-=a.speed.gravity.y,a.affects.physics.gravity&&(a.speed.gravity.x+=b.physics.gravity.x,a.speed.gravity.y+=b.physics.gravity.y),a.speed.x+=a.speed.gravity.x,a.speed.y+=a.speed.gravity.y},b.cleanUpSpeed=function(a){a.speed.x=parseFloat(a.speed.x.toFixed(3)),a.speed.y=parseFloat(a.speed.y.toFixed(3)),a.speed.t.x+=a.speed.x,a.speed.t.y+=a.speed.y,a.speed.t.x=parseFloat(a.speed.t.x.toFixed(3)),a.speed.t.y=parseFloat(a.speed.t.y.toFixed(3)),a.resetAcceleration(),0===a.speed.x&&(a.speed.t.x=0),0===a.speed.y&&(a.speed.t.y=0)},function(a){for(var c,d=0;d<a.scene.sprites.length;d++)c=a.scene.sprites[d],c.affects.physics.friction&&b.addFriction(c,a),b.spriteHitsPlatformBelow(c,a)||b.spriteHitsPlatformAbove(c,a)?b.spriteSlowerThanCollisionSprite("x",c,a)?c.speed.x=a.scene.sprites[c.collision.sprite.id].speed.x:b.spriteFasterThanCollisionSprite("x",c,a)&&(c.speed.x=a.scene.sprites[c.collision.sprite.id].speed.x):(b.spriteHitsPlatformRight(c,a)||b.spriteHitsPlatformLeft(c,a))&&(b.spriteSlowerThanCollisionSprite("y",c,a)?c.speed.y=a.scene.sprites[c.collision.sprite.id].speed.y:b.spriteFasterThanCollisionSprite("y",c,a)&&(c.speed.y=a.scene.sprites[c.collision.sprite.id].speed.y)),b.increaseAcceleration(c),b.setSpeed(c),b.addGravity(c,a),b.cleanUpSpeed(c)}}),Molecule.module("Molecule.Scene",function(){function a(){this.sprites=new Array,this.text=new Array}return a}),Molecule.module("Molecule.Sound",function(){function a(){this.sound=null}return a.prototype.play=function(a){a=a||!1,this.sound.currentTime===this.sound.duration&&this.stop(),this.sound.loop=a,this.sound.play()},a.prototype.pause=function(){this.sound.pause()},a.prototype.stop=function(){this.sound.pause(),this.sound.currentTime=0},a}),Molecule.module("Molecule.Sprite",function(a){function b(a,b,d){return this.name=a,this.image=null,this.position={x:0,y:0,absolute:{x:0,y:0}},this.rotation=0,this.move={x:0,y:0},this.flip={x:!1,y:!1,offset:{x:0,y:0},f:{x:0,y:0}},this.anchor={x:0,y:0},this.visible=!0,this.alpha=1,this.frame={width:b,height:d,offset:{x:0,y:0,width:0,height:0}},this.animation=new c(this.frame.width,this.frame.height),this.size={width:0,height:0},this.collides={sprite:!0,map:!0},this.scrollable=!0,this.collidable=!0,this.platform=!1,this.bounciness=!1,this.acceleration={x:0,y:0},this.speed={x:0,y:0,t:{x:0,y:0},max:{x:100,y:100},min:{x:0,y:0},check:{x:!1,y:!1},gravity:{x:0,y:0}},this.affects={physics:{gravity:!0,friction:!0}},this.collision={map:{up:!1,down:!1,left:!1,right:!1,tile:null},sprite:{up:!1,down:!1,left:!1,right:!1,id:null},check:{map:{up:!0,down:!0,left:!0,right:!0}}},this.overlap=!1,this.kill=!1,this.game=null,this.width=0,this.height=0,this}var c=a("Molecule.Animation");return b.prototype.getAnimation=function(){this.size={width:this.image.width,height:this.image.height},this.frame.width=this.frame.width||this.size.width,this.frame.height=this.frame.height||this.size.height,this.width=this.frame.width,this.height=this.frame.height,this.animation.sliceFrames(this.image.width,this.image.height,this.frame.width,this.frame.height)},b.prototype.flipUpdate=function(){this.flip.offset.x=this.flip.x?-this.frame.width:0,this.flip.offset.y=this.flip.y?-this.frame.height:0,this.flip.f.x=this.flip.x?-1:1,this.flip.f.y=this.flip.y?-1:1},b.prototype.update=function(){this.position.x+=this.move.x,this.position.y+=this.move.y,this.position.x=parseFloat(this.position.x.toFixed(3)),this.position.y=parseFloat(this.position.y.toFixed(3)),this.position.absolute.x=this.position.x,this.position.absolute.y=this.position.y,-1!==this.game.map.getMainLayer()&&(this.position.absolute.x+=Math.abs(this.game.map.json.layers[this.game.map.getMainLayer()].x),this.position.absolute.y+=Math.abs(this.game.map.json.layers[this.game.map.getMainLayer()].y)),this.size.width=this.frame.width-this.frame.offset.x-this.frame.offset.x,this.size.height=this.frame.height-this.frame.offset.y-this.frame.offset.y,this.width=this.size.width,this.height=this.size.height},b.prototype.resetMove=function(){this.move={x:0,y:0}},b.prototype.resetAcceleration=function(){this.acceleration={x:0,y:0}},b.prototype.draw=function(a){this.overlap===a&&this.position.x-this.anchor.x+this.frame.width>=0&&this.position.y-this.anchor.y+this.frame.height>=0&&this.position.x-this.anchor.x<=this.game.width&&this.position.y-this.anchor.y<=this.game.height&&(this.game.context.save(),this.game.context.globalAlpha=this.alpha,this.game.context.scale(1*this.flip.f.x,1*this.flip.f.y),this.game.context.translate(Math.round(this.position.x*this.flip.f.x+this.flip.offset.x),Math.round(this.position.y*this.flip.f.y+this.flip.offset.y)),this.game.context.rotate(this.rotation*(Math.PI/180)),this.game.context.translate(Math.round(-this.anchor.x*this.flip.f.x),Math.round(-this.anchor.y*this.flip.f.y)),this.game.context.drawImage(this.image,this.animation.frame[this.animation.id[this.animation.current.animation].frame[this.animation.current.frame]].x,this.animation.frame[this.animation.id[this.animation.current.animation].frame[this.animation.current.frame]].y,this.frame.width,this.frame.height,0,0,this.frame.width,this.frame.height),this.game.context.restore())},b.prototype.touch=function(){for(var a=this.game.input.touch,b=0;b<a.length;b++)if(this.position.x-this.anchor.x+this.frame.offset.x<=a[b].x&&this.position.x-this.anchor.x+this.frame.width-this.frame.offset.x>a[b].x&&this.position.y-this.anchor.y+this.frame.offset.y<=a[b].y&&this.position.y-this.anchor.y+this.frame.height-this.frame.offset.y>a[b].y)return!0;return!1},b.prototype.click=function(a){var b=this.game.input.mouse;return this.position.x-this.anchor.x+this.frame.offset.x<=b.x&&this.position.x-this.anchor.x+this.frame.width-this.frame.offset.x>b.x&&this.position.y-this.anchor.y+this.frame.offset.y<=b.y&&this.position.y-this.anchor.y+this.frame.height-this.frame.offset.y>b.y&&a?!0:!1},b.prototype.collidesWithSprite=function(a){return(this.position.x-this.anchor.x+this.move.x+this.frame.offset.x<=a.position.x-a.anchor.x+a.move.x+a.frame.offset.x&&this.position.x-this.anchor.x+this.frame.width-this.frame.offset.x+this.move.x>a.position.x-a.anchor.x+a.move.x+a.frame.offset.x||a.position.x-a.anchor.x+a.move.x+a.frame.offset.x<=this.position.x-this.anchor.x+this.move.x+this.frame.offset.x&&a.position.x-a.anchor.x+a.move.x+a.frame.width-a.frame.offset.x>this.position.x-this.anchor.x+this.move.x+this.frame.offset.x)&&(this.position.y-this.anchor.y+this.move.y+this.frame.offset.y<=a.position.y-a.anchor.y+a.move.y+a.frame.offset.y&&this.position.y-this.anchor.y+this.frame.height-this.frame.offset.y+this.move.y>a.position.y-a.anchor.y+a.move.y+a.frame.offset.y||a.position.y-a.anchor.y+a.move.y+a.frame.offset.y<=this.position.y-this.anchor.y+this.move.y+this.frame.offset.y&&a.position.y-a.anchor.y+a.move.y+a.frame.height-a.frame.offset.y>this.position.y-this.anchor.y+this.move.y+this.frame.offset.y)?!0:!1},b.prototype.collidesWithTile=function(a,b,c){var d=Math.abs(a.x),e=Math.abs(a.y);_object={position:{x:Math.floor(b%a.width)*this.game.map.json.tilewidth,y:Math.floor(b/a.width)*this.game.map.json.tilewidth},width:this.game.map.json.tilesets[this.game.map.getTileset(a.data[b])].tilewidth,height:this.game.map.json.tilesets[this.game.map.getTileset(a.data[b])].tileheight};var f=this.position.x-this.anchor.x+this.move.x+this.frame.offset.x+d,g=this.position.x-this.anchor.x+this.frame.width-this.frame.offset.x+this.move.x+d,h=this.position.x-this.anchor.x+this.move.x+this.frame.offset.x+d,i=this.position.x-this.anchor.x+this.move.x+this.frame.offset.x+d;a.properties.scroll.infinite.x&&(f>=this.game.map.canvas[c].width&&(f=Math.floor(f%this.game.map.canvas[c].width)),g>=this.game.map.canvas[c].width&&(g=Math.floor(g%this.game.map.canvas[c].width)),h>=this.game.map.canvas[c].width&&(h=Math.floor(h%this.game.map.canvas[c].width)),i>=this.game.map.canvas[c].width&&(i=Math.floor(i%this.game.map.canvas[c].width)));var j=this.position.y-this.anchor.y+this.move.y+this.frame.offset.y+e,k=this.position.y-this.anchor.y+this.frame.height-this.frame.offset.y+this.move.y+e,l=this.position.y-this.anchor.y+this.move.y+this.frame.offset.y+e,m=this.position.y-this.anchor.y+this.move.y+this.frame.offset.y+e;return a.properties.scroll.infinite.y&&(j>=this.game.map.canvas[c].height&&(j=Math.floor(j%this.game.map.canvas[c].height)),k>=this.game.map.canvas[c].height&&(k=Math.floor(k%this.game.map.canvas[c].height)),l>=this.game.map.canvas[c].height&&(l=Math.floor(l%this.game.map.canvas[c].height)),m>=this.game.map.canvas[c].height&&(m=Math.floor(m%this.game.map.canvas[c].height))),(f<=_object.position.x&&g>_object.position.x||_object.position.x<=h&&_object.position.x+_object.width>i)&&(j<=_object.position.y&&k>_object.position.y||_object.position.y<=l&&_object.position.y+_object.height>m)?!0:!1},b}),Molecule.module("Molecule.SpriteCollisions",function(a,b){return b.spritesCollide=function(a,b){return a.collides.sprite&&b.collidable&&a.collidable&&a.collidesWithSprite(b)},b.updateCollisionY=function(a,b,c,d,e){a.collidesWithSprite(b)&&(a.move.y>0&&(a.collision.sprite.down=!0,b.collision.sprite.up=!0),a.move.y<0&&(a.collision.sprite.up=!0,b.collision.sprite.down=!0),a.collision.sprite.down&&e.gravity.y>0&&(a.speed.gravity.y=0),a.collision.sprite.up&&e.gravity.y<0&&(a.speed.gravity.y=0),a.collision.sprite.id=d,b.collision.sprite.id=c,a.move.y=0,a.speed.y=0,a.speed.t.y=0)},b.updateCollisionX=function(a,b,c,d,e){a.collidesWithSprite(b)&&(a.move.x>0&&(a.collision.sprite.right=!0,b.collision.sprite.left=!0),a.move.x<0&&(a.collision.sprite.left=!0,b.collision.sprite.right=!0),a.collision.sprite.left&&e.gravity.x<0&&(a.speed.gravity.x=0),a.collision.sprite.right&&e.gravity.x>0&&(a.speed.gravity.x=0),a.collision.sprite.id=d,b.collision.sprite.id=c,a.move.x=0,a.speed.x=0,a.speed.t.x=0)},function(a){var c,d,e,f,g,h,i,j,k,l=a.scene.sprites,m=a.physics;for(c=0;c<l.length;c++)for(j=l[c],d=0;d<l.length;d++)if(k=l[d],c!==d){if(h=k.move.x,i=k.move.y,b.spritesCollide(j,k)&&(d>c&&(k.move.x=0,k.move.y=0),b.spritesCollide(j,k)))for(e=0;2>=e;)(0!==j.move.x||0!==j.move.y)&&((0===e||2===e)&&(f=j.move.x,j.move.x=0,b.updateCollisionY(j,k,c,d,m),j.move.x=f),(1===e||2===e)&&(g=j.move.y,2!==e&&(j.move.y=0),b.updateCollisionX(j,k,c,d,m),j.move.y=g)),e++;k.move.x=h,k.move.y=i}}}),Molecule.module("Molecule.Text",function(){function a(a,b,c,d,e){this.game=e,this.title=void 0===d?null:d,this.x=b||0,this.y=c||0,this.align="left",this.font=a,this.color="#FFFFFF",this.baseline="top",this.alpha=1,this.visible=!0,this.stroke={enable:!1,color:"#000000"}}return a.prototype.draw=function(){this.game.context.save(),null!==this.font&&(this.game.context.font=this.font),this.game.context.globalAlpha=this.alpha,this.game.context.textAlign=this.align,this.game.context.textBaseline=this.baseline,this.game.context.fillStyle=this.color,this.game.context.fillText(this.title,this.x,this.y),this.stroke.enable&&(this.game.context.strokeStyle=this.stroke.color,this.game.context.strokeText(this.title,this.x,this.y)),this.game.context.restore()},a.prototype.measure=function(){return this.game.context.measureText(this.title).width},a}),Molecule.module("Molecule.Tile",function(){function a(a){this.game=a}return a.prototype.get=function(a,b,c){var d=this.game.map.getTileData(a,b,c);return d},a.prototype.set=function(a,b,c,d,e){this.game.map.setTile(a,b,c,d,e)},a.prototype.clear=function(a,b,c){var d=this.game.map.clearTile(a,b,c);return d},a});